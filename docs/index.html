<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marginal Effects for Model Objects • margins</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><meta property="og:title" content="Marginal Effects for Model Objects">
<meta property="og:description" content="An R port of Stata's 'margins' command, which can be used to
    calculate marginal (or partial) effects from model objects.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">margins</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.23</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/Introduction.html">An Introduction to 'margins'</a>
    </li>
    <li>
      <a href="articles/Stata.html">Comparison with Stata's 'margins' command</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/leeper/margins">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<div id="marginal-effects-for-model-objects" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#marginal-effects-for-model-objects" class="anchor"></a>Marginal Effects for Model Objects</h1></div>
<p>The <strong>margins</strong> and <strong>prediction</strong> packages are a combined effort to port the functionality of Stata’s (closed source) <a href="http://www.stata.com/help.cgi?margins"><code>margins</code></a> command to (open source) R. The major functionality of <code>margins</code> - namely the estimation of marginal (or partial) effects - is provided through a single function, <code><a href="reference/margins.html">margins()</a></code>. This is an S3 generic method for calculating the marginal effects of covariates included in model objects (like those of classes “lm” and “glm”). Users interested in generating predicted (fitted) values, such as the “predictive margins” generated by Stata’s <code>margins</code> command, should consider using <code><a href="http://www.rdocumentation.org/packages/prediction/topics/prediction">prediction()</a></code> from the sibling project, <a href="https://cran.r-project.org/package=prediction"><strong>prediction</strong></a>.</p>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>With the introduction of Stata’s <code>margins</code> command, it has become incredibly simple to estimate average marginal effects (i.e., “average partial effects”) and marginal effects at representative cases. Indeed, in just a few lines of Stata code, regression results for almost any kind model can be transformed into meaningful quantities of interest and related plots:</p>
<pre><code>. import delimited mtcars.csv
. quietly reg mpg c.cyl##c.hp wt
. margins, dydx(*)
------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         cyl |   .0381376   .5998897     0.06   0.950    -1.192735     1.26901
          hp |  -.0463187    .014516    -3.19   0.004     -.076103   -.0165343
          wt |  -3.119815    .661322    -4.72   0.000    -4.476736   -1.762894
------------------------------------------------------------------------------
. marginsplot</code></pre>
<div class="figure">
<img src="http://i.imgur.com/VhoaFGp.png" alt="marginsplot"><p class="caption">marginsplot</p>
</div>
<p>Stata’s <code>margins</code> command is incredibly robust. It works with nearly any kind of statistical model and estimation procedure, including OLS, generalized linear models, panel regression models, and so forth. It also represents a significant improvement over Stata’s previous marginal effects command - <code>mfx</code> - which was subject to various well-known bugs. While other Stata modules have provided functionality for deriving quantities of interest from regression estimates (e.g., <a href="http://gking.harvard.edu/clarify">Clarify</a>), none has done so with the simplicity and genearlity of <code>margins</code>.</p>
<p>By comparison, R has no robust functionality in the base tools for drawing out marginal effects from model estimates (though the S3 <code>predict()</code> methods implement some of the functionality for computing fitted/predicted values). The closest approximation is <a href="https://cran.r-project.org/package=modmarg">modmarg</a>, which does one-variable-at-a-time estimation of marginal effects is quite robust. Other than this relatively new package on the scene, no packages implement appropriate marginal effect estimates. Notably, several packages provide estimates of marginal effects for different types of models. Among these are <a href="https://cran.r-project.org/package=car">car</a>, <a href="https://cran.r-project.org/package=alr3">alr3</a>, <a href="https://cran.r-project.org/package=mfx">mfx</a>, <a href="https://cran.r-project.org/package=erer">erer</a>, among others. Unfortunately, none of these packages implement marginal effects correctly (i.e., correctly account for interrelated variables such as interaction terms (e.g., <code>a:b</code>) or power terms (e.g., <code>I(a^2)</code>) and the packages all implement quite different interfaces for different types of models. <a href="https://cran.r-project.org/package=interflex">interflex</a>, <a href="https://cran.r-project.org/package=interplot">interplot</a>, and <a href="https://cran.r-project.org/package=plotMElm">plotMElm</a> provide functionality simply for plotting quantities of interest from multiplicative interaction terms in models but do not appear to support general marginal effects displays (in either tabular or graphical form), while <a href="https://cran.r-project.org/package=visreg">visreg</a> provides a more general plotting function but no tabular output. <a href="https://cran.r-project.org/package=interactionTest">interactionTest</a> provides some additional useful functionality for controlling the false discovery rate when making such plots and interpretations, but is again not a general tool for marginal effect estimation.</p>
<p>Given the challenges of interpreting the contribution of a given regressor in any model that includes quadratic terms, multiplicative interactions, a non-linear transformation, or other complexities, there is a clear need for a simple, consistent way to estimate marginal effects for popular statistical models. This package aims to correctly calculate marginal effects that include complex terms and provide a uniform interface for doing those calculations. Thus, the package implements a single S3 generic method (<code><a href="reference/margins.html">margins()</a></code>) that can be easily generalized for any type of model implemented in R.</p>
<p>Some technical details of the package are worth briefly noting. The estimation of marginal effects relies on numerical approximations of derivatives produced using <code>predict()</code> (actually, a wrapper around <code>predict()</code> called <code><a href="http://www.rdocumentation.org/packages/prediction/topics/prediction">prediction()</a></code> that is type-safe). Variance estimation, by default is provided using the delta method a numerical approximation of <a href="https://en.wikipedia.org/wiki/Jacobian_matrix_and_determinant">the Jacobian matrix</a>. While symbolic differentiation of some models (e.g., basic linear models) is possible using <code>D()</code> and <code>deriv()</code>, R’s modelling language (the “formula” class) is sufficiently general to enable the construction of model formulae that contain terms that fall outside of R’s symbolic differentiation rule table (e.g., <code>y ~ factor(x)</code> or <code>y ~ I(FUN(x))</code> for any arbitrary <code>FUN()</code>). By relying on numeric differentiation, <code><a href="reference/margins.html">margins()</a></code> supports <em>any</em> model that can be expressed in R formula syntax. Even Stata’s <code>margins</code> command is limited in its ability to handle variable transformations (e.g., including <code>x</code> and <code>log(x)</code> as predictors) and quadratic terms (e.g., <code>x^3</code>); these scenarios are easily expressed in an R formula and easily handled, correctly, by <code><a href="reference/margins.html">margins()</a></code>.</p>
</div>
<div id="simple-code-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-code-examples" class="anchor"></a>Simple code examples</h2>
<p>Replicating Stata’s results is incredibly simple using just the <code><a href="reference/margins.html">margins()</a></code> method to obtain average marginal effects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"margins"</span>)
mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>cyl <span class="op">*</span><span class="st"> </span>hp <span class="op">+</span><span class="st"> </span>wt, <span class="dt">data =</span> mtcars)
(marg1 &lt;-<span class="st"> </span><span class="kw"><a href="reference/margins.html">margins</a></span>(mod1))</code></pre></div>
<pre><code>## Average marginal effects</code></pre>
<pre><code>## lm(formula = mpg ~ cyl * hp + wt, data = mtcars)</code></pre>
<pre><code>##      cyl       hp    wt
##  0.03814 -0.04632 -3.12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(marg1)</code></pre></div>
<pre><code>##  factor     AME     SE       z      p   lower   upper
##     cyl  0.0381 0.5999  0.0636 0.9493 -1.1376  1.2139
##      hp -0.0463 0.0145 -3.1909 0.0014 -0.0748 -0.0179
##      wt -3.1198 0.6613 -4.7176 0.0000 -4.4160 -1.8236</code></pre>
<p>With the exception of differences in rounding, the above results match identically what Stata’s <code>margins</code> command produces.</p>
<p>If you are only interested in obtaining the marginal effects (without corresponding variances or the overhead of creating a “margins” object), you can call <code><a href="reference/marginal_effects.html">marginal_effects(x)</a></code> directly. Furthermore, the <code><a href="reference/dydx.html">dydx()</a></code> function enables the calculation of the marginal effect of a single named variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># all marginal effects, as a data.frame</span>
<span class="kw">head</span>(<span class="kw"><a href="reference/marginal_effects.html">marginal_effects</a></span>(mod1))</code></pre></div>
<pre><code>##     dydx_cyl     dydx_hp   dydx_wt
## 1 -0.6572244 -0.04987248 -3.119815
## 2 -0.6572244 -0.04987248 -3.119815
## 3 -0.9794364 -0.08777977 -3.119815
## 4 -0.6572244 -0.04987248 -3.119815
## 5  0.5747624 -0.01196519 -3.119815
## 6 -0.7519926 -0.04987248 -3.119815</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># subset of all marginal effects, as a data.frame</span>
<span class="kw">head</span>(<span class="kw"><a href="reference/marginal_effects.html">marginal_effects</a></span>(mod1, <span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">"cyl"</span>, <span class="st">"hp"</span>)))</code></pre></div>
<pre><code>##     dydx_cyl     dydx_hp
## 1 -0.6572244 -0.04987248
## 2 -0.6572244 -0.04987248
## 3 -0.9794364 -0.08777977
## 4 -0.6572244 -0.04987248
## 5  0.5747624 -0.01196519
## 6 -0.7519926 -0.04987248</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># marginal effect of one variable</span>
<span class="kw">head</span>(<span class="kw"><a href="reference/dydx.html">dydx</a></span>(mtcars, mod1, <span class="st">"cyl"</span>))</code></pre></div>
<pre><code>##     dydx_cyl
## 1 -0.6572244
## 2 -0.6572244
## 3 -0.9794364
## 4 -0.6572244
## 5  0.5747624
## 6 -0.7519926</code></pre>
<p>These functions may be useful for plotting, getting a quick impression of the results, or for using unit-specific marginal effects in further analyses.</p>
<div id="counterfactual-datasets-at-and-subgroup-analyses" class="section level3">
<h3 class="hasAnchor">
<a href="#counterfactual-datasets-at-and-subgroup-analyses" class="anchor"></a>Counterfactual Datasets (<code>at</code>) and Subgroup Analyses</h3>
<p>The package also implement’s one of the best features of <code>margins</code>, which is the <code>at</code> specification that allows for the estimation of average marginal effects for counterfactual datasets in which particular variables are held at fixed values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># webuse margex</span>
<span class="kw">library</span>(<span class="st">"webuse"</span>)
webuse<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/webuse/topics/webuse">webuse</a></span>(<span class="st">"margex"</span>)
<span class="co"># logistic outcome treatment##group age c.age#c.age treatment#c.age</span>
mod2 &lt;-<span class="st"> </span><span class="kw">glm</span>(outcome <span class="op">~</span><span class="st"> </span>treatment <span class="op">*</span><span class="st"> </span>group <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">^</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>treatment, <span class="dt">data =</span> margex, <span class="dt">family =</span> binomial)

<span class="co"># margins, dydx(*)</span>
<span class="kw">summary</span>(<span class="kw"><a href="reference/margins.html">margins</a></span>(mod2))</code></pre></div>
<pre><code>##     factor     AME     SE       z      p   lower   upper
##        age  0.0096 0.0008 12.3763 0.0000  0.0081  0.0112
##      group -0.0479 0.0129 -3.7044 0.0002 -0.0733 -0.0226
##  treatment  0.0432 0.0147  2.9320 0.0034  0.0143  0.0720</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># margins, dydx(treatment) at(age=(20(10)60))</span>
<span class="kw">summary</span>(<span class="kw"><a href="reference/margins.html">margins</a></span>(mod2, <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>)), <span class="dt">variables =</span> <span class="st">"treatment"</span>))</code></pre></div>
<pre><code>##     factor     age     AME     SE       z      p   lower  upper
##  treatment 20.0000 -0.0009 0.0043 -0.2061 0.8367 -0.0093 0.0075
##  treatment 30.0000  0.0034 0.0107  0.3199 0.7490 -0.0176 0.0245
##  treatment 40.0000  0.0301 0.0170  1.7736 0.0761 -0.0032 0.0634
##  treatment 50.0000  0.0990 0.0217  4.5666 0.0000  0.0565 0.1415
##  treatment 60.0000  0.1896 0.0384  4.9341 0.0000  0.1143 0.2649</code></pre>
<p>This functionality removes the need to modify data before performing such calculations, which can be quite unwieldy when many specifications are desired.</p>
<p>If one desires <em>subgroup</em> effects, simply pass a subset of data to the <code>data</code> argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># effects for men</span>
<span class="kw">summary</span>(<span class="kw"><a href="reference/margins.html">margins</a></span>(mod2, <span class="dt">data =</span> <span class="kw">subset</span>(margex, sex <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)))</code></pre></div>
<pre><code>##     factor     AME     SE       z      p   lower   upper
##        age  0.0043 0.0007  5.7723 0.0000  0.0028  0.0057
##      group -0.0753 0.0105 -7.1745 0.0000 -0.0959 -0.0547
##  treatment  0.0381 0.0070  5.4618 0.0000  0.0244  0.0517</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># effects for wommen</span>
<span class="kw">summary</span>(<span class="kw"><a href="reference/margins.html">margins</a></span>(mod2, <span class="dt">data =</span> <span class="kw">subset</span>(margex, sex <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)))</code></pre></div>
<pre><code>##     factor     AME     SE       z      p   lower  upper
##        age  0.0150 0.0013 11.5578 0.0000  0.0125 0.0176
##      group -0.0206 0.0236 -0.8742 0.3820 -0.0669 0.0256
##  treatment  0.0482 0.0231  2.0909 0.0365  0.0030 0.0934</code></pre>
</div>
<div id="plotting-and-visualization" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-and-visualization" class="anchor"></a>Plotting and Visualization</h3>
<p>The package implements several useful additional features for summarizing model objects, including:</p>
<ul>
<li>A <code>plot()</code> method for the new “margins” class that ports Stata’s <code>marginsplot</code> command.</li>
<li>A plotting function <code><a href="reference/cplot.html">cplot()</a></code> to provide the commonly needed visual summaries of predictions or average marginal effects conditional on a covariate.</li>
<li>A <code>persp()</code> method for “lm”, “glm”, and “loess” objects to provide three-dimensional representations of response surfaces or marginal effects over two covariates.</li>
<li>An <code>image()</code> method for the same that produces flat, two-dimensional heatmap-style representations of <code>persp()</code>-type plots.</li>
</ul>
<p>Using the <code>plot()</code> method yields an aesthetically similar result to Stata’s <code>marginsplot</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"webuse"</span>)
webuse<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/webuse/topics/webuse">webuse</a></span>(<span class="st">"nhanes2"</span>)
mod3 &lt;-<span class="st"> </span><span class="kw">glm</span>(highbp <span class="op">~</span><span class="st"> </span>sex <span class="op">*</span><span class="st"> </span>agegrp <span class="op">*</span><span class="st"> </span>bmi, <span class="dt">data =</span> nhanes2, <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(marg3 &lt;-<span class="st"> </span><span class="kw"><a href="reference/margins.html">margins</a></span>(mod3))</code></pre></div>
<pre><code>##  factor     AME     SE        z      p   lower   upper
##  agegrp  0.0846 0.0021  39.4392 0.0000  0.0804  0.0888
##     bmi  0.0261 0.0009  28.4995 0.0000  0.0243  0.0279
##     sex -0.0911 0.0085 -10.7063 0.0000 -0.1077 -0.0744</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(marg3)</code></pre></div>
<p><img src="https://i.imgur.com/rJ9qwFo.png" width="672"></p>
<p>In addition to the estimation procedures and <code>plot()</code> generic, <strong>margins</strong> offers several plotting methods for model objects. First, there is a new generic <code><a href="reference/cplot.html">cplot()</a></code> that displays predictions or marginal effects (from an “lm” or “glm” model) of a variable conditional across values of third variable (or itself). For example, here is a graph of predicted probabilities from a logit model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod4 &lt;-<span class="st"> </span><span class="kw">glm</span>(am <span class="op">~</span><span class="st"> </span>wt<span class="op">*</span>drat, <span class="dt">data =</span> mtcars, <span class="dt">family =</span> binomial)
<span class="kw"><a href="reference/cplot.html">cplot</a></span>(mod4, <span class="dt">x =</span> <span class="st">"wt"</span>, <span class="dt">se.type =</span> <span class="st">"shade"</span>)</code></pre></div>
<pre><code>##       xvals       yvals      upper       lower
## 1  1.513000 0.927274748 1.25767803  0.59687146
## 2  1.675958 0.896156250 1.31282164  0.47949086
## 3  1.838917 0.853821492 1.36083558  0.34680740
## 4  2.001875 0.798115859 1.38729030  0.20894142
## 5  2.164833 0.727945940 1.37431347  0.08157841
## 6  2.327792 0.644257693 1.30643930 -0.01792391
## 7  2.490750 0.550714595 1.17940279 -0.07797360
## 8  2.653708 0.453441410 1.00638808 -0.09950526
## 9  2.816667 0.359598025 0.81514131 -0.09594526
## 10 2.979625 0.275390447 0.63577343 -0.08499254
## 11 3.142583 0.204601856 0.48756886 -0.07836515
## 12 3.305542 0.148285654 0.37415646 -0.07758515
## 13 3.468500 0.105415989 0.28892829 -0.07809631
## 14 3.631458 0.073865178 0.22356331 -0.07583296
## 15 3.794417 0.051216829 0.17224934 -0.06981569
## 16 3.957375 0.035248556 0.13162443 -0.06112732
## 17 4.120333 0.024132208 0.09961556 -0.05135115
## 18 4.283292 0.016461806 0.07467832 -0.04175471
## 19 4.446250 0.011201450 0.05550126 -0.03309836
## 20 4.609208 0.007609032 0.04093572 -0.02571766</code></pre>
<p><img src="https://i.imgur.com/7gnBzwo.png" width="672"></p>
<p>And fitted values with a factor independent variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/cplot.html">cplot</a></span>(<span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>Species, <span class="dt">data =</span> iris))</code></pre></div>
<pre><code>##        xvals yvals   upper   lower
## 1     setosa 5.006 5.14869 4.86331
## 2 versicolor 5.936 6.07869 5.79331
## 3  virginica 6.588 6.73069 6.44531</code></pre>
<p><img src="https://i.imgur.com/TqTGTvX.png" width="672"></p>
<p>and a graph of the effect of <code>drat</code> across levels of <code>wt</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/cplot.html">cplot</a></span>(mod4, <span class="dt">x =</span> <span class="st">"wt"</span>, <span class="dt">dx =</span> <span class="st">"drat"</span>, <span class="dt">what =</span> <span class="st">"effect"</span>, <span class="dt">se.type =</span> <span class="st">"shade"</span>)</code></pre></div>
<p><img src="https://i.imgur.com/1bZ0EX8.png" width="672"></p>
<p><code><a href="reference/cplot.html">cplot()</a></code> also returns a data frame of values, so that it can be used just for calculating quantities of interest before plotting them with another graphics package, such as <strong>ggplot2</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"ggplot2"</span>)
dat &lt;-<span class="st"> </span><span class="kw"><a href="reference/cplot.html">cplot</a></span>(mod4, <span class="dt">x =</span> <span class="st">"wt"</span>, <span class="dt">dx =</span> <span class="st">"drat"</span>, <span class="dt">what =</span> <span class="st">"effect"</span>, <span class="dt">draw =</span> <span class="ot">FALSE</span>)
<span class="kw">head</span>(dat)</code></pre></div>
<pre><code>##   xvals  yvals  upper   lower factor
##  1.5130 0.3250 1.3927 -0.7427   drat
##  1.6760 0.3262 1.1318 -0.4795   drat
##  1.8389 0.3384 0.9214 -0.2447   drat
##  2.0019 0.3623 0.7777 -0.0531   drat
##  2.1648 0.3978 0.7110  0.0846   drat
##  2.3278 0.4432 0.7074  0.1789   drat</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> xvals)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">fill =</span> <span class="st">"gray70"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> yvals)) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Vehicle Weight (1000s of lbs)"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Average Marginal Effect of Rear Axle Ratio"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Predicting Automatic/Manual Transmission from Vehicle Characteristics"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="https://i.imgur.com/K29vTAp.png" width="672"></p>
<p>Second, the package implements methods for “lm” and “glm” class objects for the <code>persp()</code> generic plotting function. This enables three-dimensional representations of predicted outcomes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">persp</span>(mod1, <span class="dt">xvar =</span> <span class="st">"cyl"</span>, <span class="dt">yvar =</span> <span class="st">"hp"</span>)</code></pre></div>
<p><img src="https://i.imgur.com/CwXTWnm.png" width="672"></p>
<p>and marginal effects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">persp</span>(mod1, <span class="dt">xvar =</span> <span class="st">"cyl"</span>, <span class="dt">yvar =</span> <span class="st">"hp"</span>, <span class="dt">what =</span> <span class="st">"effect"</span>, <span class="dt">nx =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="https://i.imgur.com/K5IvTcL.png" width="672"></p>
<p>And if three-dimensional plots aren’t your thing, there are also analogous methods for the <code>image()</code> generic, to produce heatmap-style representations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">image</span>(mod1, <span class="dt">xvar =</span> <span class="st">"cyl"</span>, <span class="dt">yvar =</span> <span class="st">"hp"</span>, <span class="dt">main =</span> <span class="st">"Predicted Fuel Efficiency,</span><span class="ch">\n</span><span class="st">by Cylinders and Horsepower"</span>)</code></pre></div>
<p><img src="https://i.imgur.com/yX4OWrM.png" width="480"></p>
<p>The numerous package vignettes and help files contain extensive documentation and examples of all package functionality.</p>
</div>
<div id="performance" class="section level3">
<h3 class="hasAnchor">
<a href="#performance" class="anchor"></a>Performance</h3>
<p>While there is still work to be done to improve performance, <strong>margins</strong> is reasonably speedy:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"microbenchmark"</span>)
<span class="kw">microbenchmark</span>(<span class="kw"><a href="reference/marginal_effects.html">marginal_effects</a></span>(mod1))</code></pre></div>
<pre><code>## Unit: milliseconds
##                    expr      min       lq     mean   median      uq     max neval
##  marginal_effects(mod1) 4.131673 4.643902 5.675486 5.256868 6.20093 11.5074   100</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">microbenchmark</span>(<span class="kw"><a href="reference/margins.html">margins</a></span>(mod1))</code></pre></div>
<pre><code>## Unit: milliseconds
##           expr      min       lq     mean   median       uq      max neval
##  margins(mod1) 32.62725 42.80285 60.27534 58.37503 74.78273 123.3838   100</code></pre>
<p>The most computationally expensive part of <code><a href="reference/margins.html">margins()</a></code> is variance estimation. If you don’t need variances, use <code><a href="reference/marginal_effects.html">marginal_effects()</a></code> directly or specify <code><a href="reference/margins.html">margins(..., vce = "none")</a></code>.</p>
</div>
</div>
<div id="requirements-and-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements-and-installation" class="anchor"></a>Requirements and Installation</h2>
<p><a href="https://cran.r-project.org/package=margins"><img src="http://www.r-pkg.org/badges/version/margins" alt="CRAN"></a> <img src="http://cranlogs.r-pkg.org/badges/margins" alt="Downloads"><a href="https://travis-ci.org/leeper/margins"><img src="https://travis-ci.org/leeper/margins.svg?branch=master" alt="Build Status"></a> <a href="https://ci.appveyor.com/project/leeper/margins/branch/master"><img src="https://ci.appveyor.com/api/projects/status/t6nxndmvvcw3gw7f/branch/master?svg=true" alt="Build status"></a> <a href="http://codecov.io/github/leeper/margins?branch=master"><img src="http://codecov.io/github/leeper/margins/coverage.svg?branch=master" alt="codecov.io"></a> <a href="http://www.repostatus.org/#active"><img src="http://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active - The project has reached a stable, usable state and is being actively developed."></a></p>
<p>The development version of this package can be installed directly from GitHub using <code>remotes</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">"remotes"</span>)) {
    <span class="kw">install.packages</span>(<span class="st">"remotes"</span>)
    <span class="kw">library</span>(<span class="st">"remotes"</span>)
}
<span class="kw">install_github</span>(<span class="st">"leeper/prediction"</span>)
<span class="kw">install_github</span>(<span class="st">"leeper/margins"</span>)

<span class="co"># building vignettes takes a moment, so for a quicker install set:</span>
<span class="kw">install_github</span>(<span class="st">"leeper/margins"</span>, <span class="dt">build_vignettes =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=margins">https://​cloud.r-project.org/​package=margins</a>
</li>
<li>Browse source code at <br><a href="https://github.com/leeper/margins">https://​github.com/​leeper/​margins</a>
</li>
<li>Report a bug at <br><a href="https://github.com/leeper/margins/issues">https://​github.com/​leeper/​margins/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing margins</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Thomas J. Leeper <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4097-6326" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" height="16"></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas J. Leeper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
